import streamlit as st

st.set_page_config(page_title="🎯 کپشن‌ساز هوشمند", page_icon="🚀")
st.title("🎯 تولید کپشن، هشتگ و آهنگ بر اساس متن و کشور")

# دیتابیس موضوعات و لغات کلیدی
topic_keywords = {
    "آموزشی": ["آموزش", "یادگیری", "درس", "مهارت", "نکته"],
    "انگیزشی": ["هدف", "موفقیت", "پیشرفت", "دستاورد", "انگیزه"],
    "هنری": ["طراحی", "نقاشی", "رنگ", "خلاقیت", "اثر"],
    "پشت‌صحنه": ["پشت‌صحنه", "ساخت", "تمرین", "آماده‌سازی", "فرآیند"],
    "سبک زندگی": ["زندگی", "روتین", "آرامش", "لایف‌استایل", "سالم"],
    "طنز": ["شوخی", "طنز", "خنده", "لبخند", "با مزه"],
    "ماشین": ["ماشین", "خودرو", "رانندگی", "سرعت", "جاده", "اتومبیل"]
}

# دیتابیس کپشن‌ها و هشتگ‌ها
caption_db = {
    "آموزشی": {
        "captions": [
            "هر روز یه نکته، هر روز یه رشد.",
            "یادگیری یعنی قدرت.",
            "با آموزش، آینده‌تو بساز.",
            "نکته امروز رو از دست نده!"
        ],
        "hashtags": ["#آموزش", "#یادگیری", "#دانش", "#مهارت", "#رشد"]
    },
    "انگیزشی": {
        "captions": [
            "تو قوی‌تر از چیزی هستی که فکر می‌کنی.",
            "هر شکست، یه قدم به موفقیته.",
            "امروزت رو بساز، فردا خودش میاد.",
            "دستاوردهای کوچیک، مسیرهای بزرگ می‌سازن."
        ],
        "hashtags": ["#انگیزه", "#موفقیت", "#پیشرفت", "#هدف", "#مثبت_اندیشی"]
    },
    "هنری": {
        "captions": [
            "با رنگ‌ها حرف می‌زنیم.",
            "هر اثر، یه قطعه از روح ماست.",
            "خلق کردن یعنی زنده بودن.",
            "هنر یعنی دیدن زیبایی در ساده‌ترین چیزها."
        ],
        "hashtags": ["#هنر", "#خلاقیت", "#طراحی", "#نقاشی", "#زیبایی"]
    },
    "پشت‌صحنه": {
        "captions": [
            "پشت هر پست، یه داستانه.",
            "اینجا جادوی واقعی اتفاق می‌افته.",
            "یه نگاه به پشت‌پرده‌ی کارمون بنداز.",
            "ماجرا از اینجا شروع شد..."
        ],
        "hashtags": ["#پشت_صحنه", "#واقعی", "#تیم", "#فرآیند", "#داستان"]
    },
    "سبک زندگی": {
        "captions": [
            "زندگی یعنی لذت بردن از لحظه‌ها.",
            "سبک زندگی تو، امضای شخصیتته.",
            "با انتخاب‌های کوچیک، تفاوت‌های بزرگ بساز.",
            "زندگی سالم، ذهن آروم."
        ],
        "hashtags": ["#سبک_زندگی", "#لایف_استایل", "#زندگی_سالم", "#آرامش", "#انتخاب"]
    },
    "طنز": {
        "captions": [
            "اگه نخندیدی، دوباره بخونش!",
            "زندگی بدون شوخی، جدی نیست.",
            "یه لبخند کوچیک، یه حال خوب بزرگ.",
            "طنز یعنی دیدن دنیا از زاویه‌ی خنده‌دار."
        ],
        "hashtags": ["#طنز", "#شوخی", "#لبخند", "#حال_خوب", "#خنده"]
    },
    "ماشین": {
        "captions": [
            "وقتی ماشینت حرف می‌زنه، فقط گوش بده.",
            "جاده منتظر ماست، بزن بریم!",
            "سرعت؟ فقط وقتی کنترلش دست تو باشه.",
            "هر پیچ، یه ماجراجویی جدید."
        ],
        "hashtags": ["#ماشین", "#خودرو", "#جاده", "#رانندگی", "#اتومبیل"]
    }
}

# سبک موسیقی پیشنهادی
music_style = {
    "آموزشی": "lofi instrumental",
    "انگیزشی": "motivational pop",
    "هنری": "ambient classical",
    "پشت‌صحنه": "behind the scenes chill",
    "سبک زندگی": "chill lifestyle",
    "طنز": "fun upbeat",
    "ماشین": "driving beats"
}

# انتخاب کشور
country = st.selectbox("🌍 کشور مورد نظر:", ["ایران", "ترکیه", "آلمان", "امارات", "آمریکا"])

# ورودی کاربر
user_input = st.text_input("✍️ چند کلمه درباره پستت بنویس:")

# تشخیص موضوع
def detect_topic(text):
    for topic, keywords in topic_keywords.items():
        for word in keywords:
            if word in text:
                return topic
    return None

# جست‌وجوی موضوع در منو
search_input = st.text_input("🔍 جست‌وجوی موضوع (مثلاً 'آموزش' یا 'ماشین'):")
filtered_topics = [topic for topic in caption_db if search_input.lower() in topic.lower()]
selected_topic = st.selectbox("📌 انتخاب موضوع:", filtered_topics if filtered_topics else list(caption_db.keys()))

# اولویت با تشخیص خودکار
final_topic = detect_topic(user_input) if user_input else selected_topic

if final_topic:
    st.success(f"موضوع انتخاب‌شده: {final_topic}")
    st.markdown("### ✍️ کپشن‌های پیشنهادی:")
    for i, caption in enumerate(caption_db[final_topic]["captions"], 1):
        st.markdown(f"*{i}.* {caption}")
    st.markdown("### 🏷️ هشتگ‌های مناسب:")
    st.write(" ".join(caption_db[final_topic]["hashtags"]))

    # پیشنهاد آهنگ
    query = f"{music_style[final_topic]} music {country} site:youtube.com"
    search_link = f"https://www.google.com/search?q={query.replace(' ', '+')}"
    st.markdown("### 🎵 آهنگ پیشنهادی:")
    st.write(f"[جست‌وجوی آهنگ مناسب در گوگل]({search_link})")
else:
    st.warning("موضوعی تشخیص داده نشد. لطفاً از کلمات واضح‌تر استفاده کن.")
